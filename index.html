<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <style type="text/css">
        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }
        .axis text {
            font-family: sans-serif;
            font-size: 11px;
        }
		</style>
    </head>
    <body>
        <h1>Social Data Analysis and Visualisation 2017</h1>
        <h2>Assignment 2A: One scatter plot and two datasets</h2>
        <script type="text/javascript">
            var dict2003 = {};
            var dict2015 = {};
            var dataset2003 = [];
            var dataset2015 = [];
            var crimes = ["PROSTITUTION", "VEHICLE THEFT"];
            var circles;
            
            var w = 1024;
			var h = 768;
			var padding = 100;
            var year = 2003;

            var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

            var xScale;
            var yScale;
            var rScale;

            d3.csv("data_2003.csv", function(data2003) {
                console.log(data2003[0]); //show keys

                //load 2003 data
                for (i in data2003) {
                    if(i == 0 || i % 2 == 0) { continue; }
                    var district = data2003[i]['PdDistrict'];
                    if(!dict2003[district]) { 
                        dict2003[district] = {};
                        for (c in crimes) { dict2003[district][crimes[c]] = 0; }
                    }
                    var crime = data2003[i]['Category'];
                    dict2003[district][crime] = dict2003[district][crime] + 1;
                }

                //load 2015 data
                d3.csv("data_2015.csv", function(data2015) {
                    for (i in data2015) {
                        if(i == 0 || i % 2 == 0) { continue; }
                        var district = data2015[i]['PdDistrict'];
                        if(!dict2015[district]) { 
                            dict2015[district] = {};
                            for (c in crimes) { dict2015[district][crimes[c]] = 0; }
                        }
                        var crime = data2015[i]['Category'];
                        dict2015[district][crime] = dict2015[district][crime] + 1;
                    }
                    console.log(dict2003);
                    console.log(dict2015);

                    //copy data from dict to arrays
                    for (key in dict2003) {
                        var element_arr = [];
                        var element_dict = dict2003[key];
                        for (c in crimes) { element_arr.push(element_dict[crimes[c]]); }
                        element_arr.push(key);
                        dataset2003.push(element_arr); 
                    }

                    for (key in dict2015) {
                        var element_arr = [];
                        var element_dict = dict2015[key];
                        for (c in crimes) { element_arr.push(element_dict[crimes[c]]); }
                        element_arr.push(key);
                        dataset2015.push(element_arr); 
                    }

                    console.log(dataset2003);
                    console.log(dataset2015);


                    if(year == 2003) { var dataset = dataset2003; }
                    else { var dataset = dataset2015; }
                    

                    //FIND scale input domain
                    largestX = -1;
                    largestY = -1;
                    largestTotal = -1;
                    for (i in dataset2003) {
                        if(dataset2003[i][0] > largestX) { largestX = dataset2003[i][0]; }
                        if(dataset2003[i][1] > largestY) { largestY = dataset2003[i][1]; }
                        if(dataset2003[i][0] + dataset2003[i][1] > largestTotal) { largestTotal =  dataset2003[i][0] + dataset2003[i][1]; }
                    }
                    for (i in dataset2015) {
                        if(dataset2015[i][0] > largestX) { largestX = dataset2015[i][0]; }
                        if(dataset2015[i][1] > largestY) { largestY = dataset2015[i][1]; }
                        if(dataset2015[i][0] + dataset2015[i][1] > largestTotal) { largestTotal =  dataset2015[i][0] + dataset2015[i][1]; }
                    }
                    console.log("largestY");
                    console.log(largestY);

                    //SET scales
                    xScale = d3.scale.linear()
                    .domain([0, largestX])
                    .range([padding, w - padding * 2]);
                    yScale = d3.scale.linear()
                    .domain([0, largestY])
                    .range([h - padding, padding]);
                    rScale = d3.scale.linear()
                    .domain([0, largestTotal])
                    .range([2, 10]);

                    //Add the district circles
                    circles = svg.selectAll("circle") 
                    .data(dataset) .enter() 
                    .append("circle");

                    //Add district names
                    svg.selectAll("text")
                    .data(dataset) .enter() 
                    .append("text") 

                    view2003();
                     
                     //Define X axis 
                     var xAxis = d3.svg.axis() .scale(xScale) .orient("bottom");
                     //Define Y axis
                     var yAxis = d3.svg.axis() .scale(yScale) .orient("left");
                     //Create X axis
                     svg.append("g") .attr("class", "axis") .attr("transform", "translate(0," + (h - padding) + ")") .call(xAxis);
                     //Create Y axis
                     svg.append("g") .attr("class", "axis") .attr("transform", "translate(" + padding + ",0)") .call(yAxis);

                     //Add x-axis label
                     svg.append("text")
                     .attr("x", w/2 )
                     .attr("y", h - padding/2 )
                     .style("text-anchor", "middle")
                     .text("PROSITUTION");
                     
                     //Add y-axis label
                     svg.append("text")
                     .attr("transform", "rotate(-90)")
                     .attr("y", 0 + 20)
                     .attr("x",0 - (h / 2))
                     .attr("dy", "1em")
                     .style("text-anchor", "middle")
                     .text("VEHICLE THEFT");

                     //Add plot title
                     svg.append("text")
                     .attr("x", (w / 2))             
                     .attr("y", 0 + padding)
                     .attr("text-anchor", "middle")  
                     .style("font-size", "32px") 
                     .style("text-decoration", "underline")  
                     .text("SFPD prositution/theft in districts");
                });
            });
            
            function view2003() {
                    svg.selectAll("circle")
                    .data(dataset2003)
                    .transition()
                    .duration(1000)
                    .attr("cx", function(d) { return xScale(d[0]); }) 
                    .attr("cy", function(d) { return yScale(d[1]); }) 
                    .attr("r", function(d) { return rScale(d[0] + d[1]); })
                    
                    svg.selectAll("text")
                    .data(dataset2003)
                    .transition()
                    .duration(1000)
                    .text(function(d) { return d[2]; }) 
                    .attr("x", function(d) { return xScale(d[0]) + 8; }) 
                    .attr("y", function(d) { return yScale(d[1]); }) 
                    .attr("font-family", "sans-serif") 
                    .attr("font-size", "10px") 
                    .attr("fill", "red");
            }

            function view2015() {
                    svg.selectAll("circle")
                    .data(dataset2015)
                    .transition()
                    .duration(1000)
                    .attr("cx", function(d) { return xScale(d[0]); }) 
                    .attr("cy", function(d) { return yScale(d[1]); }) 
                    .attr("r", function(d) { return rScale(d[0] + d[1]); });
                    
                    svg.selectAll("text")
                    .data(dataset2015)
                    .transition()
                    .duration(1000)
                    .text(function(d) { return d[2]; }) 
                    .attr("x", function(d) { return xScale(d[0]) + 8; }) 
                    .attr("y", function(d) { return yScale(d[1]); }) 
                    .attr("font-family", "sans-serif") 
                    .attr("font-size", "10px") 
                    .attr("fill", "red");
            }
        </script>
        <input type="button" value="2003" 
        style="position:absolute; left: 5%; top: 20%; height:50px;width:100px"
        onclick="view2003()">
        <input type="button" value="2015" 
        style="position:absolute; left: 17%; top: 20%; height:50px;width:100px"
        onclick="view2015()">
        <h3>
            Explain in your own words why you think I want the axes to be the same for both years? (Even though you know how to make axes adapt to the data values.)
        </h3>
        <p>
            Using the same axes for both years make for an easy comparison between the same district in the two years. If the axes changed as well, it would be harder to make a direct comparison of position and size as you'd have to compare the values on the axes as well.
        </p>
        <h2>
            Assignment 2B: Visualizing geodata
        </h2>
        <script type="text/javascript">
            var w2 = 800;
			var h2 = 600;

            var svg2 = d3.select("body")
            .append("svg")
            .attr("width", w2)
            .attr("height", h2);

            var width = 918;
            var height = 800;
            
            var projection = d3.geo.mercator()
            .center([-122.433701, 37.747683])
            .scale(200000)
            .translate([width / 2, height / 2]);
            
            var path = d3.geo.path()
            .projection(projection);

            d3.json("sfpddistricts.geojson", function(err, json) {
                if(err) console.log("error fetching data");
                svg2.selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path);
            });
        </script>
    </body>
</html>